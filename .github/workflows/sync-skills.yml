name: Sync MCP prompts to skills folder

on:
  schedule:
    # Run daily at 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # Allow manual triggering

permissions:
  contents: write
  pull-requests: write

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Run sync script
        env:
          MCP_STRIPE_API_KEY: ${{ secrets.MCP_STRIPE_API_KEY }}
        run: node skills/sync.js

      # This action will only create a PR if there are actual changes to the file
      # If the content is identical, no PR will be created
      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: 'sync mcp.stripe.com prompts to skills and provider plugins'
          title: '[automated] sync mcp.stripe.com prompts to skills and provider plugins'
          body: |
            This is an automated PR created by the sync-skills workflow.

            Updates skills in:
            - skills/ (source)
            - providers/claude/plugin/skills/
            - providers/cursor/plugin/skills/
          branch: sync-skills-update
          delete-branch: true
          add-paths: |
            skills/**/*.md
            providers/claude/plugin/skills/
            providers/cursor/plugin/skills/
      
      - name: Check outputs
        if: steps.cpr.outputs.pull-request-number
        run: |
          echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
          echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"

